---
layout: post
categories: [hmv]
---

Уровень: coolpg

Автор: cool

Сложность: Легко

Цель: Полная компрометация виртуальной машины

![лого](assets/images/hmv/coolpg/coolpg(HMV).png)

Название coolpg дает понять что скорее всего мы будем иметь дело с SQLi, а конкретно c БД PostgreSQL

>Это мой первый врайтап, с нетерпением жду критики!

Добавляем coolpgi.hmv в /etc/hosts и поехали смотреть что же нам приготовил куллыч
## Разведка
### Результат сканирования nmap

`nmap -sV -sC -p- coolpgi.hmv`
```bash
 Starting Nmap 7.95 ( https://nmap.org ) at 2026-02-09 15:37 MSK
 Nmap scan report for coolpgi.hmv (192.168.56.110)
 Host is up (0.00084s latency).
 Not shown: 65533 closed tcp ports (reset)
 PORT   STATE SERVICE VERSION
 22/tcp open  ssh     OpenSSH 10.0p2 Debian 7 (protocol 2.0)
 80/tcp open  http    nginx
 |_http-title: CoolPG Internal
 MAC Address: 08:00:27:81:5E:CB (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
- 22/tcp open  ssh     OpenSSH 10.0p2 Debian 7 (protocol 2.0)
- 80/tcp open  http    nginx
  
Видим что на 80 порту висит сервис http, посмотрим что там

![веб морда](assets/images/hmv/coolpg/coolpg(HMV)-1.png)
Сразу смотрим исходный код страницы
![исх морды](assets/images/hmv/coolpg/coolpg(HMV)-3.png)
В исходном коде мало что интересного кроме комментария

**onboarding: ask IT for access**

Похоже что страница только "В работе"

Смотрим на возможность раскрытия информации о пользователях

При попытки ввода *admin:admin* перекидывает на пустую страницу которая говорит нам о том что раскрыть информацию о зарегистрированых пользователях в системе не предоставляется возможным, по крайней мере через страницу авторизации

**Invalid login**

Поперебираем скрытые, доступные директории и файлы
 
`feroxbuster --url "http://coolpgi.hmv" --wordlist /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x .git,.php,.html,.xml,.zip,.7z,.tar,.bak,.sql,.py,.pl,.txt,.jpg,.jpeg,.png,.js,.aac,.ogg,.flac,.alac,.wav,.aiff,.dsd,.mp3,.mp4,.mkv,.phtml -s 200 301 302`
```bash
302      GET        5l       22w      189c http://coolpgi.hmv/login => http://coolpgi.hmv/
200      GET       32l      124w     1323c http://coolpgi.hmv/
200      GET       33l      134w     1273c http://coolpgi.hmv/panel
200      GET       29l       97w      944c http://coolpgi.hmv/search
```

Смотрим /panel
![панель](assets/images/hmv/coolpg/coolpg(HMV)-10.png)
Похоже, что эта панель предназначалась администраторам для того чтобы искать пользователей в системе, посмотрим исходный код
![исхпанель](assets/images/hmv/coolpg/coolpg(HMV)-11.png)
Бэм! Комментарий разработчика недвухсмысленно намекает что нужно делать дальше

    **Dev note: access control handled upstream**

*(Заметка разраба: контроль доступа осуществляется выше по потоку )*

    **TODO: sanitize UNION reports before external exposure**

*(ЗАДАЧА: Санитизировать UNION отчеты раньше чем внешнее раскрытие  )*
>Видимо имелось ввиду залатать дыру прежде чем кто-то еще о ней узнает

Берем на заметку: Скорее всего эта форма уязвима к UNION-based SQLI 

Идем дальше и попробуем воспользоваться функционалом поиска пользователей, конечно это будет admin
![поиск пользователей](assets/images/hmv/coolpg/coolpg(HMV)-12.png)
В исходном коде ничего интересного не было, однако обращаем внимание на адресную строку по пути /search и параметр с аргументом к нему

*/search?q=admin*

Взаимодействие происходит через метод GET, как мы знаем есть инструмент позволяющий быстро протестировать базовый(и не очень) SQLI. Это будет sqlmap

---

### Эксплуатация

Без зазрений совести запустим

`sqlmap -u http://coolpgi.hmv/search?q=`
![sqlmap вход](assets/images/hmv/coolpg/coolpg(HMV)-14.png)

Система не выдержала sqlmap, можем дампить базу
`sqlmap -u http://coolpgi.hmv/search?q= --dump`
![sqlmap dump](assets/images/hmv/coolpg/coolpg(HMV)-13.png)
Нам интересны две таблицы с данными, users и secrets

Здесь мы видим пары логин/пароль от веб сервиса, но гораздо более интересным является таблица secrets которая хранит в себе данные от SSH

> ssh_user - cool

> ssh_pass - ThisIsMyPGMyAdmin 


логинимся...

Получаем первый пользовательский флаг
![userflag](assets/images/hmv/coolpg/image.png)

---

### Повышаем привелегии в системе

Сразу смотрим sudo -l

`sudo -l`
![sudol](assets/images/hmv/coolpg/coolpg(HMV)-19.png)
![seescript](assets/images/hmv/coolpg/coolpg(HMV)-20.png)
![seeprveleg](assets/images/hmv/coolpg/coolpg(HMV)-21.png)

Тут мы можем запускать скрипт от имени администратора без пароля

Сам скрипт…интересный

Этот скрипт - легкий путь к повышению привилегий в системе, ведь буквально при запуске его от имени администратора, спавниться оболочка bash с его же привелегиями 

Если чуть детальнее: Скрипт инициализирует утилиту find которая в свою очередь начинает поиск в домашнем каталоге с глубиной 3, ищет он все файлы которые имеют любое имя но главное заканчиваются на .log

Для каждого найденного файла запускается интерактивная оболочка bash, однако поиск останавливается после первого найденного файла

Исходя из того что имеется в домашнем каталоге, не трудно догадаться что мы полностью удовлетворяем условия этого скрипта, ведь у нас там лежит debug.log

Получаем наши права и забираем последний флаг

![rootflag](assets/images/hmv/coolpg/image(1).png)

БЭМ!
